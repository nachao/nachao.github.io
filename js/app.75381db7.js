(function(t){function e(e){for(var r,o,u=e[0],a=e[1],c=e[2],f=0,m=[];f<u.length;f++)o=u[f],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&m.push(s[o][0]),s[o]=0;for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r]);l&&l(e);while(m.length)m.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],r=!0,u=1;u<n.length;u++){var a=n[u];0!==s[a]&&(r=!1)}r&&(i.splice(e--,1),t=o(o.s=n[0]))}return t}var r={},s={app:0},i=[];function o(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=r,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var u=window["webpackJsonp"]=window["webpackJsonp"]||[],a=u.push.bind(u);u.push=e,u=u.slice();for(var c=0;c<u.length;c++)e(u[c]);var l=a;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var r=n("85ec"),s=n.n(r);s.a},"0462":function(t,e,n){},"136c":function(t,e,n){"use strict";var r=n("d8c0"),s=n.n(r);s.a},"15ef":function(t,e,n){"use strict";var r=n("4edf"),s=n.n(r);s.a},"19c7":function(t,e,n){"use strict";var r=n("7c86"),s=n.n(r);s.a},"203f":function(t,e,n){"use strict";var r=n("609d"),s=n.n(r);s.a},"29f1":function(t,e){t.exports=roughViz},"4edf":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("0fae");var r=n("9e2f"),s=n.n(r),i=(n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("8bbf")),o=n.n(i),u=n("5880"),a=n.n(u),c=n("8c4f"),l={amount:function(t){return t.currentExamUesdQuestionIds.length}},f=l,m=(n("d81d"),n("7db0"),n("f529")),d=n.n(m),p=n("0631"),h=n.n(p);h.a.init({appId:"q3OmcGL6fBlFSkK6rDgLCmOh-gzGzoHsz",appKey:"vT7tMvcpLI5yg7DR47gTBUwN"});var b=h.a;function g(t){d()({message:t.rawMessage,type:"error"})}function v(){return new b.Query("Questions").count().catch(g)}function x(t){var e=t.skip;return new b.Query("Questions").descending("createdAt").skip(e).limit(10).find()}function O(t){var e=t.objectId;return new b.Query("Questions").equalTo("objectId",e).first().catch(g)}function y(t){var e=t.objectId,n=t.title;return b.Object.createWithoutData("Questions",e).set("title",n).save()}function I(t){var e=t.objectId;return b.Object.createWithoutData("Questions",e).destroy()}function w(t){var e=t.questionId;return new b.Query("Question_Answers").equalTo("questionId",e).find()}function _(t){var e=t.limit,n=void 0===e?1:e;return new b.Query("Questions").select(["questionId"]).limit(n).find().catch(g)}function j(t){var e=t.title,n=b.Object.extend("Questions");return(new n).set("title",e).set("userId",b.User.current().id).save()}function E(t){var e=t.text,n=t.right,r=t.questionId,s=b.Object.extend("Question_Answers");return(new s).set("text",e).set("right",n).set("questionId",r).save()}function k(t){var e=t.objectId;return b.Object.createWithoutData("Question_Answers",e).destroy()}function q(t){var e=t.text,n=t.right,r=t.objectId;return b.Object.createWithoutData("Question_Answers",r).set("text",e).set("right",n).save()}var P=n("c32d"),Q=n.n(P),C="User_Exam_Log",S="User_Exam_Questions_Answers";function T(){var t=new b.Object.extend(C);return(new t).set("userId",b.User.current().id).save().catch(g)}function U(){return new b.Query(C).equalTo("userId",b.User.current().id).equalTo("finish",!1).descending("createdAt").first().catch(g)}function A(){return new b.Query(C).equalTo("userId",b.User.current().id).descending("score").addDescending("totalTime").first().catch(g)}function D(){return new b.Query(C).equalTo("userId",b.User.current().id).greaterThan("createdAt",Q()().startOf("week")._d).count().catch(g)}function N(t){var e=t.examId,n=t.questionId,r=new b.Object.extend(S);return(new r).set("examId",e).set("questionId",n).set("userId",b.User.current().id).save().catch(g)}function M(t){var e=t.responseId,n=t.answerIds,r=t.right;return b.Object.createWithoutData(S,e).set("answerIds",n).set("right",r).save().catch(g)}function $(t){var e=t.examId,n=t.totalTime,r=new b.ACL;return r.setPublicReadAccess(!0),r.setWriteAccess(b.User.current(),!0),b.Object.createWithoutData(C,e).set("finish",!0).set("totalTime",n).setACL(r).save().catch(g)}function L(t){var e=t.examId,n=t.score,r=t.totalTime,s=new b.ACL;return s.setPublicReadAccess(!0),s.setWriteAccess(b.User.current(),!0),b.Object.createWithoutData(C,e).set("score",n).set("totalTime",r).setACL(s).save().catch(g)}function R(t){var e=t.examId;return new b.Query(S).equalTo("examId",e).select(["questionId"]).find().catch(g)}function W(t){var e=t.examId;return new b.Query(S).equalTo("examId",e).count().catch(g)}var V={setNext:function(t){var e=t.getters,n=t.dispatch,r=t.commit,s=e.amount+10;return _({limit:s}).then((function(t){var e=t.map((function(t){return t.id})),s=r("getRandom",e);n("setNextQuestion",s)}))},setNextQuestion:function(t){var e=t.state,n={questionId:e.currentExamQuestionId,examId:e.currentExamId};n.questionId&&N(n).then((function(t){e.currentExamResponseId=t.id,e.currentExamUesdQuestionIds.push(n.questionId)}))},setAbandonExam:function(t){var e=t.state,n=t.commit,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;$({examId:e.currentExamId,totalTime:r}).then((function(){n("resetExam")}))}},Y=V,F=(n("4160"),n("caad"),n("4e82"),n("2532"),n("159b"),n("3e8f"),{getRandom:function(t,e){t.currentExamQuestionId=e[0],e.sort((function(){return Math.random()>.5?-1:1})).forEach((function(e){t.currentExamUesdQuestionIds.includes(e)||(t.currentExamQuestionId=e)}))},resetExam:function(t){t.currentExamId="",t.currentExamQuestionId="",t.currentExamResponseId="",t.currentExamUesdQuestionIds=[]},setCurrentExamId:function(t,e){t.currentExamId=e},setCurrentExamUesdQuestionIds:function(t,e){t.currentExamUesdQuestionIds=e},setQuestionCount:function(t,e){t.questionCount=e},setBeginDate:function(t,e){t.beginDate=e},setRightCount:function(t,e){t.rightCount=e},updateRightCount:function(t){t.rightCount+=1},setWeekExamCount:function(t,e){t.weekExamCount=e}}),B=F,K={namespaced:!0,state:{currentExamId:"",currentExamQuestionId:"",currentExamResponseId:"",currentExamUesdQuestionIds:[],questionCount:0,rightCount:0,beginDate:"",weekExamCount:0},getters:f,mutations:B,actions:Y},z=K,J={namespaced:!0,state:{user:{}},mutations:{setUser:function(t,e){console.log(444,e),e&&(t.user={infoId:e.id,nickname:e.attributes.nickname,signature:e.attributes.signature,higbestScore:e.attributes.higbestScore||0,leastTime:e.attributes.leastTime||0,isManage:e.attributes.isManage||!1})},setLogout:function(t){t.user={}}}},G=J,H={user:G,exam:z},X=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.loading?[t._v("加载中...")]:[n("Remark"),t.user.infoId?n("el-row",[n("el-col",{attrs:{span:16,xs:24}},[n("UserInfo"),t.currentExamId?n("ExamInfo"):t._e(),t.currentExamQuestionId?n("ExamProcess"):n("ExamPre")],1),n("el-col",{attrs:{span:8,xs:24}},[n("StatRank"),n("StatCompletionPie")],1)],1):n("Login")]],2)},Z=[],tt=(n("a4d3"),n("4de4"),n("e439"),n("dbb4"),n("b64b"),n("d3b7"),n("2fa7"));function et(t){var e=t.account,n=t.password;return new b.User.logIn(e,n)}function nt(t){var e=t.account,n=t.password;return(new b.User).setUsername(e).setPassword(n).signUp().catch(g)}function rt(){var t=b.Object.extend("User_Info"),e=b.User.current(),n=e.id,r=e.attributes.username;return(new t).set("userId",n).set("nickname",r).save().catch(g)}function st(t){var e=t.infoId,n=t.nickname;return b.Object.createWithoutData("User_Info",e).set("nickname",n).save()}function it(t){var e=t.infoId,n=t.signature;return b.Object.createWithoutData("User_Info",e).set("signature",n).save()}function ot(){return new b.User.logOut}function ut(){var t=b.User.current();return t&&t.id?new b.Query("User_Info").equalTo("userId",b.User.current().id).first():Promise.resolve()}function at(t){var e=t.higbestScore,n=t.infoId,r=b.Object.createWithoutData("User_Info",n);return r.set("higbestScore",e).save()}var ct=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"login-and-register"},[n("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"账号",prop:"account"}},[n("el-input",{model:{value:t.form.account,callback:function(e){t.$set(t.form,"account",e)},expression:"form.account"}})],1),n("el-form-item",{attrs:{label:"密码",prop:"password"}},[n("el-input",{attrs:{type:"password"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:t.setSubmit}},[t._v("登陆/自动注册")])],1)],1)],1)},lt=[];function ft(){return new b.Query("User_Info").descending("higbestScore").addAscending("leastTime").select(["nickname","higbestScore","signature"]).include("nickname").limit(10).find()}function mt(t){var e=t.score;return new b.Query("Stat_Scores").equalTo("score",e).first()}function dt(t){var e=t.score,n=b.Object.extend("Stat_Scores");return(new n).set("score",e).set("value",1).save()}function pt(t){var e=t.value,n=t.objectId;return b.Object.createWithoutData("Stat_Scores",n).set("value",e).save()}function ht(){return new b.Query("Stat_Users").descending("createdAt").first()}function bt(){return new b.Query("Stat_Users").greaterThan("createdAt",Q()().startOf("days")._d).first()}function gt(t){var e=t.value,n=b.Object.extend("Stat_Users");return(new n).set("value",e).save()}function vt(t){var e=t.value,n=t.objectId;return b.Object.createWithoutData("Stat_Users",n).set("value",e).save()}function xt(){return new b.Query("Stat_Scores").greaterThan("value",0).descending("value").find()}function Ot(){return new b.Query("Stat_Users").descending("createdAt").limit(7).find()}function yt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function It(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?yt(n,!0).forEach((function(e){Object(tt["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yt(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var wt={name:"Login",data:function(){return{userId:0,form:{account:"",password:""},rules:{account:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}}},computed:It({},Object(u["mapState"])("user",["user"])),methods:It({},Object(u["mapMutations"])("user",["setUser"]),{setSubmit:function(){var t=this;this.$refs.form.validate((function(e){e&&t.setLogin(t.form)}))},setLogin:function(){var t=this;et(this.form).then((function(e){ut().then((function(e){t.setUser(e)})),t.$message.success("登录成功！")})).catch((function(e){211===e.code?t.setRegister():g(e)}))},setRegister:function(){var t=this;nt(this.form).then((function(e){t.userId=e.id,t.$message.success("注册成功！")})).then((function(){t.setUserInfo()}))},setUserInfo:function(){var t=this;rt().then((function(e){t.setUser(e),t.setUserCount()}))},setUserCount:function(){ht().then((function(t){var e=t?t.attributes.value:0;bt().then((function(t){t?vt({value:t.attributes.value+1,objectId:t.id}).then():gt({value:e+1}).then()}))}))}})},_t=wt,jt=(n("fbc4"),n("2877")),Et=Object(jt["a"])(_t,ct,lt,!1,null,"c77340fc",null),kt=Et.exports,qt=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},Pt=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"remark"},[n("p",[t._v(" 登录/注册账号。 "),n("small",[t._v("未登录，则显示登陆/注册表单，登陆后，显示用户名称，点击名字可以设置昵称和签名。开始报名后展示进度（1/100）与得分，开始第n题开始答题。")])]),n("p",[t._v(" 开始答题，每个题限时，选择答案或限时给可执行的函数。（核心） "),n("small",[t._v("手动触发开始，开始后及计时。回答中，关闭页面算放弃。一周只能考两次，单次时间为完成或放弃时间，可以放弃后重新开始考试。")])]),n("p",[t._v(" 每个题回答结束后，可以打分，可以评论，可以下一题。共一百道题。（互动） ")]),n("p",[t._v(" 手绘版图表，一个完成度饼图，一个参与人数曲线，前10名完成度与时间规则的排名用户。（反馈） "),n("small",[t._v("侧栏固定依次展示，我的进度、饼图、曲线、排名信息。")])]),n("hr"),n("p",[t._v(" 永久存储，简单交互。 ")])])}],Qt={name:"Remark"},Ct=Qt,St=(n("eff9"),Object(jt["a"])(Ct,qt,Pt,!1,null,"ac7bebc4",null)),Tt=St.exports,Ut=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"user-info"},[n("h1",{staticClass:"nickname"},[n("span",{staticClass:"text",on:{click:t.openSet}},[t._v(t._s(t.user.nickname||"?"))]),n("el-button",{attrs:{type:"text"},on:{click:t.logout}},[t._v("注销")]),t.user.isManage?n("router-link",{staticStyle:{"margin-left":"20px"},attrs:{to:"/commit"}},[n("el-button",{attrs:{type:"text"}},[t._v("题目管理")])],1):t._e()],1),n("p",{staticClass:"signature"},[t._v(t._s(t.user.signature))]),n("UserSetInfo",{ref:"setInfo"})],1)},At=[],Dt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{attrs:{title:"设置",width:"400px",visible:t.dialogVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[n("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"昵称",prop:"nickname"}},[n("el-input",{model:{value:t.form.nickname,callback:function(e){t.$set(t.form,"nickname",e)},expression:"form.nickname"}})],1),n("el-form-item",{attrs:{label:"签名",prop:"signature"}},[n("el-input",{attrs:{type:"textarea",row:3},model:{value:t.form.signature,callback:function(e){t.$set(t.form,"signature",e)},expression:"form.signature"}})],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:t.closeDialog}},[t._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:t.setSubmit}},[t._v("确 定")])],1)],1)},Nt=[];function Mt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function $t(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Mt(n,!0).forEach((function(e){Object(tt["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Mt(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Lt={name:"UserSetInfo",data:function(){return{dialogVisible:!1,form:{nickname:"",signature:""},rules:{nickname:[{required:!0,message:"昵称不能为空",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],signature:[{max:100,message:"最大长度到 100 个字符",trigger:"blur"}]}}},computed:$t({},Object(u["mapState"])("user",["user"])),methods:{setSubmit:function(){var t=this;this.$refs.form.validate((function(e){if(e){var n=t.user.infoId,r=t.form,s=r.nickname,i=r.signature;Promise.resolve().then((function(){if(t.user.nickname!==t.form.nickname)return st({nickname:s,infoId:n}).then((function(){t.user.nickname=t.form.nickname}))})).then((function(){if(t.user.signature!==t.form.signature)return it({signature:i,infoId:n}).then((function(){t.user.signature=t.form.signature}))})).finally((function(){t.closeDialog()}))}}))},closeDialog:function(){this.dialogVisible=!1},open:function(){console.log(222,this.dialogVisible),this.dialogVisible=!0,this.form.nickname=this.user.nickname,this.form.signature=this.user.signature}}},Rt=Lt,Wt=Object(jt["a"])(Rt,Dt,Nt,!1,null,null,null),Vt=Wt.exports;function Yt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ft(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Yt(n,!0).forEach((function(e){Object(tt["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Yt(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Bt={name:"UserInfo",data:function(){return{examData:{}}},computed:Ft({},Object(u["mapState"])("user",["user"])),methods:Ft({},Object(u["mapMutations"])("user",["setLogout"]),{},Object(u["mapMutations"])("exam",["resetExam"]),{logout:function(){ot(),this.setLogout(),this.resetExam()},requestBestExam:function(){var t=this;A().then((function(e){var n=e.attributes,r=n.score,s=n.totalTime;t.examData={score:r,totalTime:s}}))},openSet:function(){this.$refs.setInfo.open()}}),components:{UserSetInfo:Vt},mounted:function(){this.requestBestExam()}},Kt=Bt,zt=(n("c13d"),Object(jt["a"])(Kt,Ut,At,!1,null,"167732f2",null)),Jt=zt.exports,Gt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{},[t.loading?[t._v("加载中...")]:[t.questionCount>=t.MIN_QUESTION_QUANTITY?[t.currentExamId&&t.amount<=t.questionCount?[n("el-button",{attrs:{type:"primary"},on:{click:t.setNext}},[t._v("开始第"+t._s(t.amount+1)+"题")]),n("el-button",{on:{click:t.setAbandon}},[t._v("放弃此轮")])]:[t.weekExamCount<t.WEEK_APPLY_QUANTITY?n("el-button",{attrs:{type:"primary"},on:{click:t.setApply}},[t._v("现在报名（本周剩余次数: "+t._s(t.WEEK_APPLY_QUANTITY-t.weekExamCount)+"）")]):n("el-button",{attrs:{type:"primary",disabled:""}},[t._v("每周仅"+t._s(t.WEEK_APPLY_QUANTITY)+"次报名机会")])]]:n("el-button",{attrs:{type:"primary",disabled:""}},[t._v("尚未开放（进度 "+t._s(t.questionCount)+" / "+t._s(t.MIN_QUESTION_QUANTITY)+"）")])]],2)},Ht=[],Xt=100,Zt=2;function te(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ee(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?te(n,!0).forEach((function(e){Object(tt["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):te(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ne={name:"ExamPre",data:function(){return{MIN_QUESTION_QUANTITY:Xt,WEEK_APPLY_QUANTITY:Zt,loading:!0}},computed:ee({},Object(u["mapState"])("user",["user"]),{},Object(u["mapState"])("exam",["questionCount","currentExamId","currentExamUesdQuestionIds","beginDate","weekExamCount"]),{},Object(u["mapGetters"])("exam",["amount"])),methods:ee({},Object(u["mapMutations"])("exam",["setCurrentExamId","setCurrentExamUesdQuestionIds","setQuestionCount","setBeginDate","setWeekExamCount"]),{},Object(u["mapActions"])("exam",["setNext","setAbandonExam"]),{getQuestionCount:function(){var t=this;return v().then((function(e){t.setQuestionCount(e)}))},getWeekTimes:function(){var t=this;return D().then((function(e){t.setWeekExamCount(e)}))},getMyExam:function(){var t=this;return U().then((function(e){e&&(t.setBeginDate(e.createdAt),t.setCurrentExamId(e.id))}))},getCurrentExamQuestion:function(){var t=this;return R({examId:this.currentExamId}).then((function(e){t.setCurrentExamUesdQuestionIds(e.map((function(t){return t.attributes.questionId})))}))},setAbandon:function(){var t=moment().diff(this.beginDate,"s");this.setAbandonExam(t)},setFinish:function(){(this.amount>=this.questionCount||this.amount>=Xt)&&this.setAbandon()},setApply:function(){var t=this;return T().then((function(){t.setWeekExamCount(t.weekExamCount+1),t.getMyExam()}))}}),created:function(){var t=this;this.getQuestionCount().then((function(){return t.getWeekTimes()})).then((function(){return t.getMyExam()})).then((function(){return t.currentExamId&&t.getCurrentExamQuestion()})).then((function(){return t.currentExamId&&t.setFinish()})).then((function(){return t.loading=!1}))}},re=ne,se=Object(jt["a"])(re,Gt,Ht,!1,null,null,null),ie=se.exports,oe=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{},[t.status<2?n("div",{staticClass:"exam-timer",staticStyle:{width:"200px"}},[n("span",{staticClass:"text"},[t._v("剩余"+t._s(t.timerValue)+"秒")]),n("el-progress",{attrs:{percentage:t.timerPercetage,format:t.formatProgress}})],1):t._e(),n("h3",[t._v(t._s(t.question))]),t.status>0?n("el-checkbox-group",{model:{value:t.answerIds,callback:function(e){t.answerIds=e},expression:"answerIds"}},t._l(t.answers,(function(e){return n("el-checkbox",{key:e.id,attrs:{label:e.id,disabled:1!==t.status}},[t._v(t._s(e.text))])})),1):t._e(),n("br"),t.status>1&&t.allowNext?n("el-button",{attrs:{type:"primary"},on:{click:t.setNext}},[t._v("开始第"+t._s(t.amount+1)+"题")]):t._e(),t.status>1&&!t.allowNext?n("el-button",{attrs:{type:"primary"},on:{click:t.setFinish}},[t._v("完成")]):t._e(),t.status>1?n("QuestionTalkList",{attrs:{questionId:t.currentExamQuestionId}}):t._e()],1)},ue=[],ae=(n("99af"),n("a623"),n("13d5"),n("e25e"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"question-talk-list"},[n("QuestionTalkForm",{attrs:{questionId:t.questionId},on:{success:t.updateTalkMessage}}),n("div",[0===t.list.length?n("div",{staticClass:"empty"},[t._v("暂无评论")]):t._e(),t._l(t.list,(function(e,r){return[e.message?n("div",{key:r,staticClass:"talk-item"},[n("p",{staticClass:"nickname"},[t._v(t._s(e.user||"?"))]),n("p",{staticClass:"message"},[t._v(t._s(e.message))])]):t._e()]})),t.total>t.limit?[n("el-pagination",{attrs:{layout:"prev, pager, next",background:"",total:t.total},on:{"current-change":t.getCurrent}})]:t._e()],2)],1)}),ce=[];function le(t){var e=t.message,n=t.questionId,r=b.Object.extend("Question_Talk");return(new r).set("message",e).set("questionId",n).set("userId",b.User.current().id).save().catch(g)}function fe(t){var e=t.questionId,n=t.limit,r=t.skip,s=new b.Query("Question_Talk");return s.equalTo("questionId",e),s.descending("createdAt"),s.limit(n).skip(r),s.find().catch(g)}function me(t){var e=t.questionId,n=t.skip,r=t.limit,s=new b.Query("Question_Talk"),i=new b.Query("User_Info");return s.equalTo("questionId",e),s.descending("createdAt"),s.limit(r).skip(n),i.matchesKeyInQuery("userId","userId",s),i.find().catch(g)}function de(t){var e=t.questionId;return new b.Query("Question_Talk").equalTo("questionId",e).count().catch(g)}var pe=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"question-talk-form"},[n("el-form",{attrs:{inline:!0}},[n("el-form-item",[n("el-input",{model:{value:t.message,callback:function(e){t.message=e},expression:"message"}})],1),n("el-form-item",[n("el-button",{on:{click:t.setSubmit}},[t._v("评论")])],1)],1)],1)},he=[];function be(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ge(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?be(n,!0).forEach((function(e){Object(tt["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):be(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ve={name:"QuestionTalkForm",props:{questionId:{type:String,required:!0}},data:function(){return{message:""}},computed:ge({},Object(u["mapState"])("user",["user"])),methods:{setSubmit:function(){var t=this;le({message:this.message,questionId:this.questionId}).then((function(e){t.$emit("success",{user:t.user.nickname,message:t.message}),t.message=""}))}}},xe=ve,Oe=(n("c781"),Object(jt["a"])(xe,pe,he,!1,null,"50864a59",null)),ye=Oe.exports,Ie={name:"QuestionTalkList",props:{questionId:{type:String,required:!0}},data:function(){return{total:0,current:0,limit:10,list:[]}},computed:{requestQuery:function(){return{limit:this.limit,skip:this.limit*(this.current-1),questionId:this.questionId}}},methods:{getCurrent:function(t){this.current=t,t&&this.requestMessage()},requestMessage:function(){var t=this;fe(this.requestQuery).then((function(e){t.list=e.map((function(t){return{id:t.id,uid:t.attributes.userId,message:t.attributes.message,user:""}})),t.list.length>0&&t.requestMessageUsers()}))},requestMessageUsers:function(){var t=this;me(this.requestQuery).then((function(e){var n={};e.forEach((function(t){n[t.attributes.userId]=t.attributes.nickname})),t.list.forEach((function(t){t.user=n[t.uid]}))}))},requestTotal:function(){var t=this;de({questionId:this.questionId}).then((function(e){t.total=e}))},updateTalkMessage:function(t){this.list.unshift(t)}},components:{QuestionTalkForm:ye},created:function(){this.requestMessage(),this.requestTotal()}},we=Ie,_e=(n("15ef"),Object(jt["a"])(we,ae,ce,!1,null,"7b619a90",null)),je=_e.exports;function Ee(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ke(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ee(n,!0).forEach((function(e){Object(tt["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ee(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var qe={name:"ExamProcess",data:function(){return{MIN_QUESTION_QUANTITY:Xt,question:"",answers:[],answerIds:[],status:0,timer:null,timerValue:1,timerTotal:1,timerPercetage:100}},computed:ke({},Object(u["mapState"])("user",["user"]),{},Object(u["mapState"])("exam",["currentExamId","currentExamQuestionId","currentExamResponseId","questionCount","rightCount","beginDate"]),{},Object(u["mapGetters"])("exam",["amount"]),{allowNext:function(){return this.amount<this.questionCount||this.amount<Xt}}),watch:{currentExamResponseId:function(){this.questionItem(),this.questionAnswers()}},methods:ke({},Object(u["mapMutations"])("exam",["updateRightCount"]),{},Object(u["mapActions"])("exam",["setNext","setAbandonExam"]),{setTimer:function(t,e){var n=this;this.timer||(this.timerTotal=t<10?10:t,this.timerValue=this.timerTotal,this.timer=setInterval((function(){n.timerValue-=1,n.timerPercetage=parseInt(n.timerValue/n.timerTotal*100),n.timerValue<=0&&(clearInterval(n.timer),n.timer=null,e())}),500))},questionItem:function(){var t=this;this.status=0,O({objectId:this.currentExamQuestionId}).then((function(e){t.question=e.attributes.title,t.setTimer(t.question.length,(function(){t.status=1;var e=t.answers.map((function(t){return t.text.length})).concat(0).reduce((function(t,e){return t+e}));t.setTimer(e,(function(){t.status=2,t.addExamQuestionAnswer()}))}))}))},questionAnswers:function(){var t=this;w({questionId:this.currentExamQuestionId}).then((function(e){t.answers=e.map((function(t){return{id:t.id,text:t.attributes.text,right:t.attributes.right}}))}))},formatProgress:function(t){return""},parseRight:function(){var t=this;return this.answers.every((function(e){return e.right===t.answerIds.includes(e.id)}))},addExamQuestionAnswer:function(){var t=this,e=this.parseRight();M({responseId:this.currentExamResponseId,answerIds:this.answerIds,right:e}).then((function(n){e&&t.updateRightCount(),t.setFinishAnswer()}))},setFinishAnswer:function(){var t=this;this.settlementExam(),this.setUpdateExam(),this.rightCount>this.user.higbestScore&&at({higbestScore:this.rightCount,infoId:this.user.infoId}).then((function(){t.rightCount>1&&t.setProportion(t.rightCount-1,-1),t.setProportion(t.rightCount)}))},setProportion:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;mt({score:t}).then((function(n){n?pt({value:n.attributes.value+e,objectId:n.id}).then():1===e&&dt({score:t,value:1}).then()}))},setUpdateExam:function(){(this.amount>=this.questionCount||this.amount>=Xt)&&this.setFinish()},settlementExam:function(){var t=Q()().diff(this.beginDate,"s");L({examId:this.currentExamId,score:this.rightCount,totalTime:t}).then((function(){}))},setFinish:function(){finishExam({examId:this.currentExamId}).then()}}),components:{QuestionTalkList:je},created:function(){this.questionItem(),this.questionAnswers()}},Pe=qe,Qe=(n("203f"),Object(jt["a"])(Pe,oe,ue,!1,null,"280383e7",null)),Ce=Qe.exports,Se=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{},[t.amount?n("h5",[t._v(" 进度："+t._s(t.amount)+" / "+t._s(t.MIN_QUESTION_QUANTITY)+" "),n("p",[t._v("分数: "+t._s(t.rightCount))])]):t._e()])},Te=[];function Ue(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ae(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ue(n,!0).forEach((function(e){Object(tt["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ue(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var De={name:"ExamInfo",data:function(){return{MIN_QUESTION_QUANTITY:Xt}},computed:Ae({},Object(u["mapState"])("exam",["currentExamId","rightCount"]),{},Object(u["mapGetters"])("exam",["amount"])),methods:Ae({},Object(u["mapMutations"])("exam",["setRightCount"])),mounted:function(){var t=this;W({examId:this.currentExamId}).then((function(e){t.setRightCount(e)}))}},Ne=De,Me=Object(jt["a"])(Ne,Se,Te,!1,null,null,null),$e=Me.exports,Le=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},Re=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{attrs:{id:"pie0"}}),n("div",{attrs:{id:"line0"}})])}],We=n("29f1"),Ve=n.n(We),Ye={name:"StatCompletionPie",data:function(){return{proportion:[],userCount:[]}},methods:{requestProportion:function(){var t=this,e=[],n=[];return xt().then((function(r){r.forEach((function(t){e.push("完成".concat(t.attributes.score,"道题的人数")),n.push(t.attributes.value)})),t.proportion={labels:e,values:n}}))},requestUserCountAll:function(){var t=this,e=[],n=[];return Ot().then((function(r){r.forEach((function(t,r){e.push(Q()(t.createdAt).format("MM/DD")+"人数"),n.unshift(t.attributes.value)})),t.userCount={labels:e,values:n}}))},drawPie:function(){new Ve.a.Pie({element:"#pie0",title:"completion proportion",titleFontSize:"1em",legend:!1,roughness:1,strokeWidth:2,width:300,height:300,color:"pink",fillWeight:1.5,data:this.proportion})},drawBar:function(){new Ve.a.Bar({title:"user counting",titleFontSize:"1em",element:"#line0",data:this.userCount,width:300,height:300,roughness:1,margin:{top:50,right:20,bottom:70,left:40}})}},mounted:function(){var t=this;this.requestProportion().then((function(){return t.drawPie()})).then((function(){return t.requestUserCountAll()})).then((function(){return t.drawBar()}))}},Fe=Ye,Be=Object(jt["a"])(Fe,Le,Re,!1,null,null,null),Ke=Be.exports,ze=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"stat-rank"},t._l(t.list,(function(e){return n("div",{key:e.id,staticClass:"item"},[n("span",{staticClass:"index"},[t._v(t._s(e.score||0))]),n("span",{staticClass:"text"},[t._v(" "+t._s(e.nickname)+" "),n("p",{staticClass:"signature"},[t._v(t._s(e.signature))])])])})),0)},Je=[],Ge={name:"StatRank",data:function(){return{list:[]}},methods:{requestUsersRank:function(){var t=this;ft().then((function(e){t.list=e.map((function(t){return{id:t.id,nickname:t.attributes.nickname,signature:t.attributes.signature,score:t.attributes.higbestScore}}))}))}},created:function(){this.requestUsersRank()}},He=Ge,Xe=(n("19c7"),Object(jt["a"])(He,ze,Je,!1,null,"d829117c",null)),Ze=Xe.exports;function tn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function en(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?tn(n,!0).forEach((function(e){Object(tt["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tn(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var nn={data:function(){return{loading:!0}},computed:en({},Object(u["mapState"])("user",["user"]),{},Object(u["mapState"])("exam",["currentExamId","currentExamQuestionId"])),methods:en({},Object(u["mapMutations"])("user",["setUser"])),components:{Remark:Tt,Login:kt,UserInfo:Jt,ExamPre:ie,ExamProcess:Ce,ExamInfo:$e,QuestionTalkForm:ye,QuestionTalkList:je,StatCompletionPie:Ke,StatRank:Ze},mounted:function(){var t=this;this.loading=!0,ut().then((function(e){return t.setUser(e)})).finally((function(){t.loading=!1}))}},rn=nn,sn=Object(jt["a"])(rn,X,Z,!1,null,null,null),on=sn.exports,un=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("h1",[t._v("Commit")]),n("el-form",[n("el-form-item",{attrs:{label:"问题",prop:"title"}},[n("el-input",{model:{value:t.form.text,callback:function(e){t.$set(t.form,"text",e)},expression:"form.text"}})],1),n("el-form-item",[n("el-button",{on:{click:t.pushAnswer}},[t._v("添加项")]),t.formCopy.text!==t.form.text?n("el-button",{attrs:{type:"primary"},on:{click:t.addQuestion}},[t._v("提交")]):t._e(),n("el-button",{attrs:{type:"text"},on:{click:t.resetSubmit}},[t._v("重置")])],1),t._l(t.answers,(function(e,r){return n("div",{key:r},[n("el-form-item",{attrs:{label:"正确"}},[n("el-radio-group",{model:{value:e.right,callback:function(n){t.$set(e,"right",n)},expression:"answer.right"}},[n("el-radio",{attrs:{label:!0}},[t._v("是")]),n("el-radio",{attrs:{label:!1}},[t._v("否")])],1)],1),n("el-form-item",{attrs:{label:"答案"+(r+1)}},[n("el-input",{model:{value:e.text,callback:function(n){t.$set(e,"text",n)},expression:"answer.text"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"danger"},on:{click:function(n){return t.removeAnswer(e)}}},[t._v("删除项")]),t.verifyDiff(e,t.answersCopy[r])?n("el-button",{attrs:{type:"primary"},on:{click:function(n){return t.addAnswer(e,r)}}},[t._v("确定")]):t._e()],1)],1)}))],2),n("h2",{staticStyle:{"margin-top":"200px"}},[t._v(" Questions "),n("small",[t._v("( "+t._s(t.count)+" )")])]),t._l(t.questions,(function(e){return n("div",{key:e.id},[n("hr"),n("div",[n("p",[t._v(t._s(e.text))]),n("el-button",{on:{click:function(n){return t.questionAnswers(e.id)}}},[t._v("答案")]),n("el-button",{attrs:{type:"text"},on:{click:function(n){return t.questionEdit(e)}}},[t._v("编辑")]),n("el-button",{attrs:{type:"text"},on:{click:function(n){return t.questionDelete(e)}}},[t._v("删除")])],1)])})),n("br"),n("br"),n("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:t.count},on:{"current-change":t.questionList}})],2)},an=[],cn=(n("c975"),n("a15b"),n("a434"),{data:function(){return{formCopy:{id:0,type:1,text:""},form:{id:0,type:1,text:""},questionId:"",answersCopy:[],answers:[],count:0,skip:1,limit:10,questions:[]}},methods:{resetSubmit:function(){this.form={id:0,type:1,text:""},this.answers=[]},addQuestion:function(){var t=this;this.form.id?this.questionUpdate():j({title:this.form.text,typeId:this.form.type}).then((function(e){t.formCopy.text=t.form.text,t.questionId=e.id,t.questionList()}))},questionUpdate:function(){y({objectId:this.form.id,title:this.form.text,typeId:this.form.type}).then()},questionDelete:function(t){var e=this;this.$confirm("此操作将永久删除该问题, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){I({objectId:t.id}).then((function(){e.questionList(),e.$message({type:"success",message:"删除成功!"})}))})).catch()},pushAnswer:function(){this.answers.push({text:"",right:!1}),this.answersCopy.push({text:"",right:!1})},removeAnswer:function(t){this.answers.splice(this.answers.indexOf(t),1),t.id&&k({objectId:t.id}).then((function(t){}))},addAnswer:function(t,e){var n=this;if(t.id)this.updateAnswer(t,e);else{var r=t.text,s=t.right;E({text:r,right:s,questionId:this.questionId}).then((function(t){var i=n.answersCopy[e];i.text=r,i.right=s}))}},updateAnswer:function(t,e){var n=this,r=t.text,s=t.right,i=t.id;q({text:r,right:s,objectId:i}).then((function(t){var i=n.answersCopy[e];i.text=r,i.right=s}))},verifyDiff:function(t,e){return t.text!==e.text||t.right!==e.right},questionList:function(t){var e=this;t&&(this.skip=t),x({skip:(this.skip-1)*this.limit}).then((function(t){e.questions=t.map((function(t){return{id:t.id,text:t.attributes.title}}))}))},questionAnswers:function(t){var e=this;w({questionId:t}).then((function(t){var n=t.map((function(t){return"<li>[".concat(t.attributes.right?"Y":"N","]").concat(t.attributes.text,"</li>")})).join("");e.$alert("<ul>".concat(n,"</ul>"),"答案",{dangerouslyUseHTMLString:!0})}))},questionEdit:function(t){var e=this;this.form={id:t.id,text:t.text,type:1},this.formCopy=JSON.parse(JSON.stringify(this.form)),this.questionId=t.id,w({questionId:t.id}).then((function(t){e.answers=t.map((function(t){return{id:t.id,text:t.attributes.text,right:t.attributes.right}})),e.answersCopy=JSON.parse(JSON.stringify(e.answers))}))}},mounted:function(){var t=this;v().then((function(e){t.count=e,t.questionList()}))}}),ln=cn,fn=(n("136c"),Object(jt["a"])(ln,un,an,!1,null,"2c8daaa2",null)),mn=fn.exports,dn=[{path:"/",component:on},{path:"/commit",component:mn}],pn=dn,hn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("router-view")},bn=[],gn=(n("034f"),{}),vn=Object(jt["a"])(gn,hn,bn,!1,null,null,null),xn=vn.exports;o.a.config.productionTip=!1,o.a.use(a.a),o.a.use(s.a);var On=new c["a"]({routes:pn}),yn=new a.a.Store({modules:H});new o.a({store:yn,router:On,render:function(t){return t(xn)}}).$mount("#app")},5880:function(t,e){t.exports=Vuex},"609d":function(t,e,n){},6525:function(t,e,n){},"78a1":function(t,e,n){},"7c86":function(t,e,n){},"85ec":function(t,e,n){},"8bbf":function(t,e){t.exports=Vue},9373:function(t,e,n){},c13d:function(t,e,n){"use strict";var r=n("0462"),s=n.n(r);s.a},c32d:function(t,e){t.exports=moment},c781:function(t,e,n){"use strict";var r=n("9373"),s=n.n(r);s.a},d8c0:function(t,e,n){},eff9:function(t,e,n){"use strict";var r=n("78a1"),s=n.n(r);s.a},fbc4:function(t,e,n){"use strict";var r=n("6525"),s=n.n(r);s.a}});
//# sourceMappingURL=app.75381db7.js.map